
# ğŸ§® æ•°å­¦è¿ç®—ä»»åŠ¡é“¾ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºCeleryå’ŒFastAPIçš„åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†ç³»ç»Ÿï¼Œæ”¯æŒæ•°å­¦è¿ç®—ä»»åŠ¡é“¾çš„å¼‚æ­¥æ‰§è¡Œå’ŒWebç•Œé¢ç®¡ç†ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **å¼‚æ­¥ä»»åŠ¡å¤„ç†**: åŸºäºCeleryçš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **æ•°å­¦è¿ç®—é“¾**: æ”¯æŒå¤šç§æ•°å­¦è¿ç®—çš„ç»„åˆæ‰§è¡Œ
- **Web APIæ¥å£**: RESTful APIæ¥å£ï¼Œæ”¯æŒä»»åŠ¡æäº¤å’ŒçŠ¶æ€æŸ¥è¯¢
- **å‰ç«¯ç•Œé¢**: ç”¨æˆ·å‹å¥½çš„Webç•Œé¢
- **æ•°æ®æŒä¹…åŒ–**: SQLiteæ•°æ®åº“å­˜å‚¨ä»»åŠ¡è®°å½•
- **å®æ—¶ç›‘æ§**: ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°
- **æ ‡å‡†åŒ–æ¶æ„**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

## ğŸ“ é¡¹ç›®ç»“æ„

```
task_chain/
â”œâ”€â”€ readme.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–åŒ…
â”œâ”€â”€ celery_app.py          # Celeryåº”ç”¨é…ç½®
â”œâ”€â”€ api.py                 # FastAPIåç«¯æœåŠ¡
â”œâ”€â”€ web_server.py          # å‰ç«¯WebæœåŠ¡å™¨
â”œâ”€â”€ web_interface.html     # Webå‰ç«¯ç•Œé¢
â”œâ”€â”€ main.py                # ä¸»ç¨‹åºç¤ºä¾‹
â”œâ”€â”€ tasks/                 # ä»»åŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ math_tasks.py      # æ•°å­¦è¿ç®—ä»»åŠ¡
â”‚   â”œâ”€â”€ data_tasks.py      # æ•°æ®å¤„ç†ä»»åŠ¡
â”‚   â””â”€â”€ io_tasks.py        # è¾“å…¥è¾“å‡ºä»»åŠ¡
â”œâ”€â”€ workflows/             # å·¥ä½œæµæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ data_workflow.py   # æ•°æ®å·¥ä½œæµ
â””â”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
    â”œâ”€â”€ test_api.py        # APIæµ‹è¯•
    â”œâ”€â”€ client_test.py     # å®¢æˆ·ç«¯æµ‹è¯•
    â””â”€â”€ curl_test.sh       # curlæµ‹è¯•è„šæœ¬
```

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

- Python 3.12+
- Redis Server
- è™šæ‹Ÿç¯å¢ƒ (æ¨è)

## ğŸ“¦ å®‰è£…æ­¥éª¤

1. **åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ**
```bash
python3.12 -m venv venv
source venv/bin/activate  # macOS/Linux
```

2. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **å¯åŠ¨RedisæœåŠ¡å™¨**
```bash
# macOS (ä½¿ç”¨Homebrew)
brew services start redis

# éªŒè¯Redisè¿è¡Œ
redis-cli ping
# åº”è¯¥è¿”å›: PONG
```

## ğŸš€ å¯åŠ¨æœåŠ¡

ç³»ç»ŸåŒ…å«3ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œéœ€è¦åˆ†åˆ«åœ¨ä¸åŒçš„ç»ˆç«¯çª—å£ä¸­å¯åŠ¨ï¼š

### 1. å¯åŠ¨Celery Worker (ç»ˆç«¯1)
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•å¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd /path/to/task_chain
source venv/bin/activate

# å¯åŠ¨Celery Worker
celery -A celery_app worker --loglevel=info
```

### 2. å¯åŠ¨FastAPIåç«¯æœåŠ¡ (ç»ˆç«¯2)
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•å¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd /path/to/task_chain
source venv/bin/activate

# å¯åŠ¨APIæœåŠ¡å™¨
python api.py
```

### 3. å¯åŠ¨å‰ç«¯WebæœåŠ¡å™¨ (ç»ˆç«¯3)
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•å¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd /path/to/task_chain
source venv/bin/activate

# å¯åŠ¨å‰ç«¯æœåŠ¡å™¨
python web_server.py
```

## ğŸŒ è®¿é—®åœ°å€

å¯åŠ¨æ‰€æœ‰æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ğŸ–¥ï¸ Webå‰ç«¯ç•Œé¢**: http://localhost:8080
- **ğŸ“š APIæ–‡æ¡£**: http://localhost:8000/docs
- **ğŸ”§ APIåŸºç¡€åœ°å€**: http://localhost:8000

## ğŸ“Š æ”¯æŒçš„æ•°å­¦è¿ç®—é“¾

### 1. åŠ æ³•â†’ä¹˜æ³•â†’é™¤æ³• (`add_multiply_divide`)
```
è¾“å…¥: a=10, b=5
æµç¨‹: (10 + 5) â†’ 15 Ã— 2 â†’ 30 Ã· 3 = 10.0
```

### 2. å¹‚è¿ç®—â†’å¼€æ–¹ (`power_sqrt`)
```
è¾“å…¥: a=3, b=4
æµç¨‹: 3^4 â†’ âˆš81 = 9.0
```

### 3. å¤æ‚æ•°å­¦è¿ç®— (`complex_math`)
```
è¾“å…¥: a=20, b=8
æµç¨‹: (20 + 8) â†’ 28 Ã— 20 â†’ 560 - 8 â†’ 552 Ã· 2 = 276.0
```

## ğŸ”Œ APIä½¿ç”¨ç¤ºä¾‹

### æäº¤ä»»åŠ¡
```bash
curl -X POST "http://localhost:8000/submit" 
  -H "Content-Type: application/json" 
  -d '{
    "a": 10,
    "b": 5,
    "operation_chain": "add_multiply_divide"
  }'
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
```bash
curl -X GET "http://localhost:8000/status/{task_id}"
```

### è·å–ä»»åŠ¡åˆ—è¡¨
```bash
curl -X GET "http://localhost:8000/tasks?limit=10"
```

## ï¿½ï¸ å¼€å‘å’Œæµ‹è¯•

### æµ‹è¯•APIåŠŸèƒ½
```bash
python test_api.py
```

### è¿è¡Œä¸»ç¨‹åºç¤ºä¾‹
```bash
python main.py
```

### ä½¿ç”¨curlæµ‹è¯•è„šæœ¬
```bash
chmod +x curl_test.sh
./curl_test.sh
```

## ğŸ“ˆ ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹CeleryçŠ¶æ€
```bash
# æŸ¥çœ‹æ´»è·ƒä»»åŠ¡
celery -A celery_app inspect active

# æŸ¥çœ‹å·²æ³¨å†Œä»»åŠ¡
celery -A celery_app inspect registered

# æŸ¥çœ‹workerçŠ¶æ€
celery -A celery_app status

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
celery -A celery_app inspect stats
```

### æ•°æ®åº“ç®¡ç†
- **æ•°æ®åº“æ–‡ä»¶**: `tasks.db` (SQLite)
- **ä»»åŠ¡è®°å½•è¡¨**: `task_records`
- **è‡ªåŠ¨åˆ›å»º**: é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨

## ğŸ”§ é…ç½®è¯´æ˜

### Redisé…ç½®
é»˜è®¤è¿æ¥é…ç½®ï¼š
- ä¸»æœº: localhost
- ç«¯å£: 6379
- æ•°æ®åº“: 0

### Celeryé…ç½®
- **æ¶ˆæ¯ä»£ç†**: Redis
- **ç»“æœåç«¯**: Redis
- **ä»»åŠ¡åºåˆ—åŒ–**: JSON
- **ç»“æœåºåˆ—åŒ–**: JSON

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Redisè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
   redis-cli ping
   # åº”è¯¥è¿”å›: PONG
   
   # å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨Redis
   brew services start redis
   ```

2. **ä»»åŠ¡æ‰§è¡Œå¤±è´¥**
   ```bash
   # æ£€æŸ¥Celery workeræ—¥å¿—
   celery -A celery_app worker --loglevel=debug
   ```

3. **APIè®¿é—®å¤±è´¥**
   ```bash
   # æ£€æŸ¥FastAPIæœåŠ¡çŠ¶æ€
   curl http://localhost:8000/
   ```

4. **å‰ç«¯è·¨åŸŸé—®é¢˜**
   - ä½¿ç”¨ http://localhost:8080 è®¿é—®å‰ç«¯
   - ä¸è¦ç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶

### å¯åŠ¨æ£€æŸ¥æ¸…å•

âœ… RedisæœåŠ¡å™¨è¿è¡Œä¸­ (`redis-cli ping`)  
âœ… è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»  
âœ… æ‰€æœ‰ä¾èµ–å·²å®‰è£… (`pip list`)  
âœ… Celery Workeræ­£å¸¸å¯åŠ¨  
âœ… FastAPIæœåŠ¡å“åº”æ­£å¸¸  
âœ… å‰ç«¯æœåŠ¡å™¨è¿è¡Œä¸­  

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webå‰ç«¯ç•Œé¢    â”‚    â”‚   FastAPIåç«¯   â”‚    â”‚  Celery Worker  â”‚
â”‚  (ç«¯å£: 8080)   â”‚â—„â”€â”€â–ºâ”‚   (ç«¯å£: 8000)  â”‚â—„â”€â”€â–ºâ”‚   (ä»»åŠ¡å¤„ç†)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  SQLiteæ•°æ®åº“   â”‚    â”‚  Redisæ¶ˆæ¯é˜Ÿåˆ—  â”‚
                       â”‚   (ä»»åŠ¡è®°å½•)    â”‚    â”‚   (ä»»åŠ¡åˆ†å‘)    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”® æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ–°ä»»åŠ¡ç±»å‹
1. åœ¨ `tasks/` ç›®å½•åˆ›å»ºæ–°çš„ä»»åŠ¡æ¨¡å—
2. ä½¿ç”¨ `@app.task` è£…é¥°å™¨å®šä¹‰ä»»åŠ¡
3. åœ¨ `celery_app.py` ä¸­å¯¼å…¥æ–°æ¨¡å—

### æ·»åŠ æ–°çš„è¿ç®—é“¾
1. åœ¨ `math_tasks.py` ä¸­å®šä¹‰æ–°çš„é“¾å¼ä»»åŠ¡
2. åœ¨ `api.py` ä¸­æ·»åŠ å¯¹åº”çš„è·¯ç”±
3. åœ¨å‰ç«¯ç•Œé¢æ·»åŠ é€‰é¡¹

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ ä½œè€…ä¿¡æ¯

- **ç‰ˆæœ¬**: 1.0.0
- **æœ€åæ›´æ–°**: 2025å¹´8æœˆ25æ—¥

---

**ğŸ‰ äº«å—åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†çš„å¼ºå¤§åŠŸèƒ½ï¼**